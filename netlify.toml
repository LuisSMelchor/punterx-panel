# netlify.toml
[build]
  # Si no tienes frontend a publicar, "." está bien
  publish = "."
  # No hay paso de build necesario para las serverless functions
  command = "echo 'No build step'"

[functions]
  # Carpeta real de tus funciones
  directory = "netlify/functions"
  # Bundler recomendado por Netlify para Node 18/20
  node_bundler = "esbuild"

  # (Opcional pero recomendado) Evita que esbuild intente bundlear el ESM de Supabase;
  # tu función lo carga con import dinámico en runtime.
  external_node_modules = ["@supabase/supabase-js"]

  # (Recomendado) Incluye plantillas/archivos que lees en runtime con fs desde __dirname
  included_files = [
    "netlify/functions/**/prompts_punterx.md"
  ]

[build.environment]
  # Asegura zona horaria coherente con tu proyecto
  TZ = "America/Mexico_City"
  # Node en producción (Netlify ya está en 20.x; esto documenta la intención)
  NODE_VERSION = "20.19.0"

############################################
# FUNCIONES PROGRAMADAS (cron)
############################################

# Principal: sigue cada 15 min
[functions."autopick-vip-nuevo"]
  schedule = "*/15 * * * *"

# Background: misma cadencia pero escalonada 2 min para evitar solaparse
# Corre al minuto 2, 17, 32, 47 de cada hora.
[functions."autopick-vip-nuevo-background"]
  schedule = "2-59/15 * * * *"

# Verificador: cada hora en el minuto 0
[functions."verificador-aciertos"]
  schedule = "0 * * * *"

# Análisis semanal: lunes 10:00 (hora de servidor/UTC)
[functions."analisis-semanal"]
  schedule = "0 10 * * 1"

# Diagnóstico/refresh dashboard: cada 10 min
[functions."diagnostico-total"]
  schedule = "*/10 * * * *"

# Outrights: cada 30 min
[functions."autopick-outrights"]
  schedule = "*/30 * * * *"
